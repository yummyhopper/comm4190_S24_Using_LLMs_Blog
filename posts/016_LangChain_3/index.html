<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.54">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Max Orenstein">
<meta name="dcterms.date" content="2024-04-19">
<meta name="description" content="I experiment prompt engineering using LangChain and build an algorithm to generate personalized emails to customers.">

<title>Automated Email Marketing Part #3: Getting LLMs to Sell – Max’s Blog</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Max’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://yummyhopper.github.io/comm4190_S24_Using_LLMs_Blog/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/max-orenstein-159b8a237/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Automated Email Marketing Part #3: Getting LLMs to Sell</h1>
                  <div>
        <div class="description">
          I experiment prompt engineering using LangChain and build an algorithm to generate personalized emails to customers.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">LangChain</div>
                <div class="quarto-category">Marketing</div>
                <div class="quarto-category">Klaviyo</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Max Orenstein </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">April 19, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="automated-email-marketing-part-3-getting-llms-to-sell" class="level1">
<h1>Automated Email Marketing Part #3: Getting LLMs to Sell</h1>
<p>In this post I build on the work I did in the last post connecting LangChain to Klaviyo. In this one I experiment prompt engineering using LangChain and build an algorithm to generate personalized emails to customers. I begin by creating chains for four essential parts of the email, write a function to build the email using those prompts, and then write a function to generate a unique email for each customer. If you already read the intial post or aren’t interested in the first part as much feel free to skip ahead.</p>
<p><img src="index_files/figure-html/98fc2ef4-aa76-4a49-a52d-89066a9897f9-1-4d723c7e-08a1-4891-ba56-9341ef3f9f6d.jpg" class="img-fluid"></p>
<section id="what-we-did-last-time-integrating-klaviyo-with-langchain" class="level3">
<h3 class="anchored" data-anchor-id="what-we-did-last-time-integrating-klaviyo-with-langchain">What we did last time: Integrating Klaviyo with LangChain</h3>
<div id="f0f98d52-3d62-40de-8d2d-ea9c5efbd555" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> requests</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> csv</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> dotenv <span class="im">import</span> load_dotenv</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> klaviyo_api <span class="im">import</span> KlaviyoAPI</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.prompts <span class="im">import</span> PromptTemplate</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain_core.prompts.chat <span class="im">import</span> ChatPromptTemplate</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.chat_models <span class="im">import</span> ChatOpenAI</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain.chains <span class="im">import</span> LLMChain</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain_core.output_parsers <span class="im">import</span> StrOutputParser</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> langchain_core.runnables <span class="im">import</span> (RunnablePassthrough, RunnableLambda, RunnableParallel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="026de839-ddff-4853-aa3f-76bd469bfd01" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>_ <span class="op">=</span> load_dotenv()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="5abe97e3-948f-4311-958e-e5998ebae327" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract Klaviyo (private) API key from .env file</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>klaviyo_key<span class="op">=</span>...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="e3a5ade6-c9f8-42b1-b70f-28a6c1587dcb" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instantiate the Klaviyo Python API with the API key</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>klaviyo <span class="op">=</span> KlaviyoAPI(klaviyo_key, max_delay<span class="op">=</span><span class="dv">60</span>, max_retries<span class="op">=</span><span class="dv">3</span>, test_host<span class="op">=</span><span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="79398f0f-14ac-483c-927e-31bf351a78b5" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract profile data and events for a Klaviyo ID as a string we can feed to LangChain</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_customer_data(custid):</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>    profile<span class="op">=</span>klaviyo.Profiles.get_profile(custid)</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    data <span class="op">=</span> profile[<span class="st">'data'</span>]</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    attributes <span class="op">=</span> data[<span class="st">'attributes'</span>]</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    properties <span class="op">=</span> attributes[<span class="st">'properties'</span>]</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    location <span class="op">=</span> attributes[<span class="st">'location'</span>]</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    info <span class="op">=</span> {key: value <span class="cf">for</span> key, value <span class="kw">in</span> attributes.items() <span class="cf">if</span> key <span class="kw">not</span> <span class="kw">in</span> [<span class="st">'properties'</span>, <span class="st">'location'</span>]}</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    combined_dict <span class="op">=</span> {<span class="op">**</span>properties, <span class="op">**</span>location, <span class="op">**</span>info}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> combined_dict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="this-time-prompt-engineering-in-langchain" class="level3">
<h3 class="anchored" data-anchor-id="this-time-prompt-engineering-in-langchain">This time: Prompt Engineering in LangChain</h3>
<p>For the prompt I’ll be using the inverted pyramid framework, building each individual part as its own individual chain. The inverted pyramid framework popular with marketers and journalists because of its focus on grabbing and holding a readers attention. There are many variants of it, but at its most basic form the inverted pyramid grabs the attention of a potential customer, builds anticipation about a product or service and then expresses a powerful call to action to convert the customer. Using LangChain we can isolate the individual parts of this pyramid to guarantee each part of the conversion funnel will be written according to its respective purpose and style.</p>
<p><img src="index_files/figure-html/48e38dd7-c6b9-4259-bdd5-a08a72d46a42-1-77f62656-fed5-440d-a948-c56d343561bb.jpg" class="img-fluid"></p>
</section>
<section id="writing-chains" class="level3">
<h3 class="anchored" data-anchor-id="writing-chains">Writing Chains</h3>
<div id="72ebd052-d3d3-4999-9e0e-24e4478acf54" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>data.keys()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>dict_keys(['Accepts Marketing', 'Shopify Tags', '$consent', '$source', '$consent_timestamp', 'clv', 'churn_risk', 'upsales_propensity', 'recommended_incentive', 'address1', 'zip', 'city', 'address2', 'latitude', 'country', 'longitude', 'region', 'timezone', 'ip', 'email', 'phone_number', 'external_id', 'anonymous_id', 'first_name', 'last_name', 'organization', 'title', 'image', 'created', 'updated', 'last_event_date'])</code></pre>
</div>
</div>
<div id="85da4be2-114f-49ec-8c9d-1c1aea013ae5" class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>grab_attention <span class="op">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'''</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="st">Write a short 2 line introduction to an email with a hook from Max's Store to </span><span class="sc">{first_name}</span><span class="st">. The email should be pitching the release and special offer of a new line of shoes called the MegaShoe 1s. Write it according to the following rules:</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="st">- Infer gender and age from </span><span class="sc">{first_name}</span><span class="st"> and tailor your style to who you're addressing</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="st">- If the customer has a high </span><span class="sc">{clv}</span><span class="st">, offer them a better deal than a customer with a lower </span><span class="sc">{clv}</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="st">- If a customer has a high </span><span class="sc">{churn_risk}</span><span class="st"> use more urgent wording in your hook</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="st">- If a customer has a higher </span><span class="sc">{upsales_propensity}</span><span class="st"> offer a more expensive product</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="st">- Tease the </span><span class="sc">{recommended_incentive}</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="st">Remember not to mention these properties explicitly, but craft your message to resonate with these insights.</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="st">No emojis and keep it short and simple. Write like a 7th grader to ensure your email is easily understood by a wide audience.</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="st">Get creative, don't just fall into bland platitudes, and you don't have to follow the examples but use them to guide you.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="st">ONLY WRITE ONE DRAFT</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="st">__</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="st">Examples: </span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="st">Hi Doug, We're excited to introduce our new product, the MegaShoe 1s, and we're offering you an exclusive 20</span><span class="sc">% d</span><span class="st">iscount for a limited time as one of our valued customers!</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="st">Hi Debby, Get ready to upgrade your style with our latest innovation - the MegaShoe 1s Supreme! As a loyal customer, we're offering you a special deal of buy one, get one 50</span><span class="sc">% o</span><span class="st">ff for a limited time only.</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="st">Hi Kendrick, Don't miss out on our newest arrival - the MegaShoe 1s Pro! With its advanced features and sleek design, it's a must-have for anyone on-the-go. And as a valued customer, we're giving you an exclusive 30</span><span class="sc">% o</span><span class="st">ff your first purchase.</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>build_anticipation <span class="op">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">'''</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="st">Write an the body of an email from Max's Store to a customer following up on the introduction of the new MegaShoe 1s. The body should:</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="st">- Establish the customer's need for a new shoe alternative</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="st">- Emphasize the key features and benefits of the MegaShoe 1s</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="st">- Highlight the special offer and create a sense of urgency</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="st">- Encourage the customer to take action and make a purchase</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="st">- Infer gender and age from </span><span class="sc">{first_name}</span><span class="st"> and tailor your style to who you're addressing</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="st">- Consider the customer's </span><span class="sc">{clv}</span><span class="st">, </span><span class="sc">{churn_risk}</span><span class="st">, and </span><span class="sc">{upsales_propensity}</span><span class="st"> to tailor the tone and content</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="st">Remember not to mention these properties explicitly, but craft your message to resonate with these insights.</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a><span class="st">No emojis and keep it short and simple. Write like a 7th grader to ensure your email is easily understood by a wide audience.</span></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="st">Get creative, don't just fall into bland platitudes, and you don't have to follow the examples but use them to guide you.</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="st">DO NOT MENTION THE CUSTOMER'S NAME HERE. YOU ARE WRITING ONE BODY PARAGRAPH NOT AN INTRO OR CONCLUSION. LITERALLY JUST ONE PARAGRAPH.</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="st">ONLY WRITE ONE DRAFT</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="st">__</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="st">- We've just launched our revolutionary MegaShoe 1s, designed to keep you comfortable and confident all day long. Whether you're hitting the gym or running errands, these shoes have got you covered. Here's what you need to know: Comfort and support: Soft materials and arch support for happy feet. Stylish and versatile: Cute design that looks great for any occasion. Durable and long-lasting: Built to withstand your active lifestyle. </span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="st">- Sick of wearing out your favorite kicks too fast? We feel you! That's why we created the MegaShoe 1s - the ultimate shoe for the active dude on the go! These bad boys are packed with: Comfy tech: Cushioning and breathability for happy feet. Supportive vibes: Stability features for high-impact activities. Fresh style: Sleek design that's perfect for the gym or just chillin'.</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="st">- Are you tired of wearing out your favorite shoes too quickly? Do you need a new go-to pair that can keep up with your active lifestyle? We've got you covered! Our brand-new MegaShoe 1s are designed to provide unparalleled comfort, support, and durability. With their cutting-edge technology and sleek design, they're perfect for fitness enthusiasts like yourself. Here's what sets them apart: Long-lasting comfort: Breathable materials and cushioning ensure your feet stay happy all day. Superior support: Stability features and arch support for high-impact activities. Style and versatility: Sleek design that looks great for both workouts and everyday wear. </span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="st">'''</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a>call_to_action <span class="op">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a>    <span class="st">'''</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="st">Craft a compelling call to action that directs the customer on what to do next. Use actionable language that conveys urgency and benefit. Ensure the call to action is simple, direct, and easy to follow. </span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="st">- Infer gender and age from </span><span class="sc">{first_name}</span><span class="st"> and tailor your style to who you're addressing</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="st">- Consider the customer's </span><span class="sc">{clv}</span><span class="st">, </span><span class="sc">{churn_risk}</span><span class="st">, and </span><span class="sc">{upsales_propensity}</span><span class="st"> to tailor the tone and content</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="st">- Offer the </span><span class="sc">{recommended_incentive}</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="st">- Be decisive and confident</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="st">Remember not to mention these properties explicitly, but craft your message to resonate with these insights.</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="st">No emojis and keep it short and simple. Write like a 7th grader to ensure your email is easily understood by a wide audience.</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="st">Get creative, don't just fall into bland platitudes, and you don't have to follow the examples but use them to guide you.</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="st">DO NOT MENTION THE CUSTOMER'S NAME HERE.</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="st">ONLY WRITE ONE DRAFT</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="st">__   </span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="st">Example:</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a><span class="st">- Don't Miss Out! Grab 10</span><span class="sc">% o</span><span class="st">ff your first MegaShoe 1s purchase and get the comfort and support you need. Limited time offer - Shop Now and Get Moving! Best Regards, Your Friends at Max's Store</span></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a><span class="st">- Treat Yourself to the Best! Enjoy 12</span><span class="sc">% o</span><span class="st">ff your first MegaShoe 1s purchase and discover the perfect blend of style and comfort. Shop Now and Elevate Your Everyday! Sincerely, your friends at Max's Store</span></span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a><span class="st">- Upgrade Your Shoe Game Now! Get 15</span><span class="sc">% o</span><span class="st">ff your first MegaShoe 1s purchase and experience the ultimate in comfort and performance. Shop Now and Take Your Fitness to the Next Level! Warmly, your friends at Max's Store</span></span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a><span class="st">    '''</span></span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>subject_line <span class="op">=</span> ChatPromptTemplate.from_template(</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>    <span class="st">'''</span></span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a><span class="st">Write a short but eye-catching subject line to an email from Max's Store mentioning the customer by </span><span class="sc">{first_name}</span><span class="st"> and the </span><span class="sc">{recommended_incentive}</span><span class="st">.</span></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a><span class="st">- No emojis and keep it short and simple. Write like a 7th grader to ensure your email is easily understood by a wide audience.</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a><span class="st">- Get creative, don't just fall into bland platitudes, and you don't have to follow the examples but use them to guide you.</span></span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a><span class="st">- ONLY WRITE ONE DRAFT</span></span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a><span class="st">__</span></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a><span class="st">Examples:</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a><span class="st">- Billy, 24 Hours to Claim Your Exclusive Gift!</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a><span class="st">- Hey Megan, We've Got a Shoe-tastic Deal for You! Coupon Inside!</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a><span class="st">- AJ, Unlock Your VIP Access: Free Shipping on MegaShoe 1s Awaits</span></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a><span class="st">    '''</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="71059f80-a4db-43a6-990f-796b757983ce" class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the chat model:</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> ChatOpenAI(model_name<span class="op">=</span><span class="st">"gpt-4"</span>, temperature<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the sub-chains:</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>grab_attention_chain <span class="op">=</span> (grab_attention <span class="op">|</span> model <span class="op">|</span> StrOutputParser())</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>build_anticipation_chain <span class="op">=</span> (build_anticipation <span class="op">|</span> model <span class="op">|</span> StrOutputParser())</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>call_to_action_chain <span class="op">=</span> (call_to_action <span class="op">|</span> model <span class="op">|</span> StrOutputParser())</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>subject_line_chain <span class="op">=</span> (subject_line <span class="op">|</span> model <span class="op">|</span> StrOutputParser())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/usr/local/anaconda3/share/jupyter/venv/py311_4130_v2/lib/python3.11/site-packages/langchain_core/_api/deprecation.py:117: LangChainDeprecationWarning: The class `langchain_community.chat_models.openai.ChatOpenAI` was deprecated in langchain-community 0.0.10 and will be removed in 0.2.0. An updated version of the class exists in the langchain-openai package and should be used instead. To use it run `pip install -U langchain-openai` and import as `from langchain_openai import ChatOpenAI`.
  warn_deprecated(</code></pre>
</div>
</div>
</section>
<section id="create-a-function-that-builds-one-email-from-the-chains" class="level3">
<h3 class="anchored" data-anchor-id="create-a-function-that-builds-one-email-from-the-chains">Create a Function That Builds One Email from the Chains</h3>
<div id="ea3934c4-52f7-4bcd-8c12-20454ad5e712" class="cell" data-scrolled="true" data-execution_count="18">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define a function that generates an email for a given customer based on their Klaviyo ID</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> generate_email(custid):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Fetch customer data</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    customer_data <span class="op">=</span> get_customer_data(custid)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Execute sub-chains</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>    attention_text <span class="op">=</span> grab_attention_chain.invoke(customer_data)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>    anticipation_text <span class="op">=</span> build_anticipation_chain.invoke(customer_data)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>    action_text <span class="op">=</span> call_to_action_chain.invoke(customer_data)</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>    subject <span class="op">=</span> subject_line_chain.invoke(customer_data)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine the outputs to form the complete email</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    email <span class="op">=</span> <span class="ss">f"</span><span class="sc">{</span>subject<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>attention_text<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>anticipation_text<span class="sc">}</span><span class="ch">\n\n</span><span class="sc">{</span>action_text<span class="sc">}</span><span class="ss">"</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> email</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>sample_email <span class="op">=</span> generate_email(<span class="st">'01HVFMJSDSK7YF1K052T4S0M44'</span>)</span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(sample_email)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>"John, Your Exclusive Max's Store Coupon is Waiting!"

Hello John, Step into the future with our brand new MegaShoe 1s, designed to redefine comfort and style. As a token of our appreciation for your loyalty, we're offering you an exclusive deal that you won't want to miss - stay tuned for a special coupon in this email!

Tired of shoes that just can't keep up with your active lifestyle? We've got the perfect solution for you! Introducing our new MegaShoe 1s, the ultimate footwear designed to provide you with unparalleled comfort, support, and durability. These shoes are packed with features that make them a game-changer: they offer long-lasting comfort with their breathable materials and cushioning, superior support with stability features and arch support for high-impact activities, and a sleek design that looks great for both workouts and everyday wear. But that's not all - for a limited time, we're offering a special 50% off on your first pair! This is a deal you don't want to miss. So why wait? Step up your shoe game and experience the difference with MegaShoe 1s today!

Jumpstart Your Journey! Snag 20% off your initial MegaShoe 1s purchase and experience unparalleled comfort. Act Fast - This offer won't last forever! Shop Now and Step Up Your Game! Yours Truly, Your Pals at Max's Store.</code></pre>
</div>
</div>
</section>
<section id="create-dictionary-with-final-email-and-address-to-send-to" class="level3">
<h3 class="anchored" data-anchor-id="create-dictionary-with-final-email-and-address-to-send-to">Create Dictionary with Final Email and Address to Send to</h3>
<div id="3c0ae3d6-330e-4e6c-8613-1984878d1941" class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get profiles from Klaviyo into a dictionary</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>profiles <span class="op">=</span> klaviyo.Profiles.get_profiles()</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize an empty list to store customer IDs</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>cust_ids <span class="op">=</span> []</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Iterate over profiles and extract customer IDs</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> profile <span class="kw">in</span> profiles[<span class="st">'data'</span>]:</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    cust_ids.append(profile[<span class="st">'id'</span>])</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>cust_ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="19">
<pre><code>['01HVFKKS3976M2BYYKRH2YE5BW',
 '01HVFKKSM9HTV1TPEASMH694MG',
 '01HVFKKSPHKNC5PV0VNN14TSJ4',
 '01HVFKKVK1HECSCYB6VVGHSSRQ',
 '01HVFMJRBBN12VGRB95NHWKBTS',
 '01HVFMJREQ54N2M732CSFX450J',
 '01HVFMJS7THFNM4R99JRWKFS1T',
 '01HVFMJSDSK7YF1K052T4S0M44',
 '01HVFMJSP8CEQK5V0YFT85VYDE',
 '01HVFMJSPXX0W8DVR30YR1T37Q',
 '01HVFMJTF6C2WHD7J4MZ5R9PAX',
 '01HVFMJTRJVBPBCY763A4M35F7',
 '01HVFMJV39QFH8AYF7D11B0KWD',
 '01HVFMJV9JTCGPE7CAYEJ6X11T']</code></pre>
</div>
</div>
<div id="b8e6ab14-7599-46cf-8d87-221581d58a93" class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> update_customer_profiles(cust_ids):</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    churn_risks <span class="op">=</span> [<span class="st">'low'</span>, <span class="st">'medium'</span>, <span class="st">'high'</span>]</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    upsales_propensities <span class="op">=</span> [<span class="st">'20%'</span>, <span class="st">'50%'</span>, <span class="st">'80%'</span>]</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    recommended_incentives <span class="op">=</span> [<span class="st">'gift'</span>, <span class="st">'coupon'</span>, <span class="st">'discount'</span>]</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>    clv_values <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">500</span>, <span class="dv">1000</span>]</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    emails <span class="op">=</span> {}</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> custid <span class="kw">in</span> cust_ids:</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>        custid_str <span class="op">=</span> <span class="bu">str</span>(custid)  <span class="co"># Ensure the custid is a string</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Generate random properties</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>        properties <span class="op">=</span> {</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>            <span class="st">'clv'</span>: random.choice(clv_values),</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>            <span class="st">'churn_risk'</span>: random.choice(churn_risks),</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>            <span class="st">'upsales_propensity'</span>: random.choice(upsales_propensities),</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>            <span class="st">'recommended_incentive'</span>: random.choice(recommended_incentives)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Prepare the payload for the API call</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a>        payload <span class="op">=</span> {</span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>            <span class="st">"data"</span>: {</span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">"type"</span>: <span class="st">"profile"</span>,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">"id"</span>: custid_str,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                <span class="st">"attributes"</span>: {</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'properties'</span>: properties</span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>                }</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a>            }</span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Update the profile</span></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>        klaviyo.Profiles.update_profile(custid_str, payload)</span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"Updated profile for ID </span><span class="sc">{</span>custid_str<span class="sc">}</span><span class="ss"> with properties: </span><span class="sc">{</span>properties<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming cust_ids is a list of customer IDs</span></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>update_customer_profiles(cust_ids)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Updated profile for ID 01HVFKKS3976M2BYYKRH2YE5BW with properties: {'clv': 1000, 'churn_risk': 'medium', 'upsales_propensity': '80%', 'recommended_incentive': 'coupon'}
Updated profile for ID 01HVFKKSM9HTV1TPEASMH694MG with properties: {'clv': 500, 'churn_risk': 'medium', 'upsales_propensity': '20%', 'recommended_incentive': 'gift'}
Updated profile for ID 01HVFKKSPHKNC5PV0VNN14TSJ4 with properties: {'clv': 1000, 'churn_risk': 'low', 'upsales_propensity': '80%', 'recommended_incentive': 'coupon'}
Updated profile for ID 01HVFKKVK1HECSCYB6VVGHSSRQ with properties: {'clv': 1000, 'churn_risk': 'high', 'upsales_propensity': '50%', 'recommended_incentive': 'gift'}
Updated profile for ID 01HVFMJRBBN12VGRB95NHWKBTS with properties: {'clv': 100, 'churn_risk': 'high', 'upsales_propensity': '20%', 'recommended_incentive': 'discount'}
Updated profile for ID 01HVFMJREQ54N2M732CSFX450J with properties: {'clv': 1000, 'churn_risk': 'high', 'upsales_propensity': '80%', 'recommended_incentive': 'discount'}
Updated profile for ID 01HVFMJS7THFNM4R99JRWKFS1T with properties: {'clv': 500, 'churn_risk': 'low', 'upsales_propensity': '50%', 'recommended_incentive': 'discount'}
Updated profile for ID 01HVFMJSDSK7YF1K052T4S0M44 with properties: {'clv': 100, 'churn_risk': 'medium', 'upsales_propensity': '50%', 'recommended_incentive': 'discount'}
Updated profile for ID 01HVFMJSP8CEQK5V0YFT85VYDE with properties: {'clv': 100, 'churn_risk': 'high', 'upsales_propensity': '80%', 'recommended_incentive': 'coupon'}
Updated profile for ID 01HVFMJSPXX0W8DVR30YR1T37Q with properties: {'clv': 1000, 'churn_risk': 'medium', 'upsales_propensity': '80%', 'recommended_incentive': 'gift'}
Updated profile for ID 01HVFMJTF6C2WHD7J4MZ5R9PAX with properties: {'clv': 1000, 'churn_risk': 'high', 'upsales_propensity': '20%', 'recommended_incentive': 'gift'}
Updated profile for ID 01HVFMJTRJVBPBCY763A4M35F7 with properties: {'clv': 1000, 'churn_risk': 'low', 'upsales_propensity': '80%', 'recommended_incentive': 'gift'}
Updated profile for ID 01HVFMJV39QFH8AYF7D11B0KWD with properties: {'clv': 500, 'churn_risk': 'medium', 'upsales_propensity': '80%', 'recommended_incentive': 'coupon'}
Updated profile for ID 01HVFMJV9JTCGPE7CAYEJ6X11T with properties: {'clv': 1000, 'churn_risk': 'medium', 'upsales_propensity': '20%', 'recommended_incentive': 'discount'}</code></pre>
</div>
</div>
<div id="4b5a32aa-7c39-4515-8146-34da8228aa3a" class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(cust_ids[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="21">
<pre><code>str</code></pre>
</div>
</div>
<div id="7fb4ec66-78c9-40ba-af58-d9d4c0d7c34a" class="cell" data-scrolled="true" data-execution_count="22">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>emails <span class="op">=</span> []</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> customer_id <span class="kw">in</span> cust_ids:</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>    message <span class="op">=</span> generate_email(customer_id)  <span class="co"># Generate the email from the data directly, without fetching again</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    emails.append(message)</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(emails)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['"Russell, Your Personalized Coupon from Max\'s Store is Here!"\n\nHey Russell, Time is running out to snag our latest sensation - the MegaShoe 1s Deluxe! As one of our top-tier customers, we\'re offering you an unbeatable deal you won\'t want to miss. Stay tuned for your exclusive coupon!\n\nAre you on the hunt for a new pair of kicks that can keep up with your active lifestyle? Look no further! Our newly launched MegaShoe 1s are the perfect blend of comfort, durability, and style. These shoes are designed with soft, breathable materials that provide all-day comfort and arch support to keep your feet happy. Plus, their robust construction ensures they can withstand the rigors of your daily activities. But that\'s not all - they also boast a sleek design that\'s versatile enough for the gym, the office, or a night out. And here\'s the kicker - for a limited time, we\'re offering a special deal on the MegaShoe 1s. But hurry, this offer won\'t last long! So, why wait? Step up your shoe game and grab a pair of MegaShoe 1s today.\n\nAct Now! Snag 20% off your first MegaShoe 1s purchase and step into a world of unparalleled comfort and style. This offer won\'t last forever - Shop Now and Elevate Your Stride! Yours Truly, Your Pals at Max\'s Store.', '"Ayumu, Your Special Gift Awaits at Max\'s Store!"\n\nSubject: Exclusive Offer Just for You, Ayumu!\n\nDear Ayumu, We\'re thrilled to introduce the MegaShoe 1s, a game-changer in footwear fashion. As one of our top customers, we\'re offering you an unbeatable deal on this premium product, and a surprise gift awaits you too! Don\'t wait, this offer won\'t last forever!\n\nFeeling like your current shoes just aren\'t cutting it anymore? We\'ve got just the solution for you! Introducing the MegaShoe 1s, the ultimate shoe for those who live life on the move. These shoes are packed with features that will make your feet sing with joy. They offer unparalleled comfort with soft, breathable materials and arch support that keeps your feet happy all day long. Plus, their stylish design makes them versatile enough for any occasion, from hitting the gym to running errands around town. But that\'s not all! These shoes are built to last, with durability that can withstand even the most active lifestyles. And here\'s the best part: for a limited time, we\'re offering a special deal on the MegaShoe 1s. But hurry, this offer won\'t last forever! So why wait? Give your feet the comfort and support they deserve with the MegaShoe 1s.\n\nStep Up Your Style! Enjoy 20% off on your first purchase and experience the perfect blend of comfort and fashion. Don\'t wait, this offer won\'t last forever. Shop Now and Elevate Your Look! Best Regards, Your Friends at Max\'s Store.', '"Karine, Your Exclusive Max\'s Store Coupon is Waiting!"\n\nSubject: Step into Style with MegaShoe 1s - Special Offer Inside!\n\nDear Karine, we\'re thrilled to announce the launch of our latest sensation, the MegaShoe 1s. As one of our esteemed customers, we\'ve crafted an exclusive, time-sensitive offer just for you - details inside!\n\nFeeling like your current shoes just aren\'t cutting it anymore? We\'ve got the perfect solution for you - our brand new MegaShoe 1s! These shoes are designed with your active lifestyle in mind, providing the ultimate comfort, support, and durability. With their innovative technology and stylish design, they\'re the perfect fit for your daily routine. Here\'s what makes them stand out: Unbeatable comfort: Soft, breathable materials and cushioning keep your feet feeling great all day. Superior support: Arch support and stability features designed for high-impact activities. Versatile style: A sleek design that\'s perfect for both workouts and casual wear. But that\'s not all - for a limited time, we\'re offering a special deal just for you! Don\'t miss out on this opportunity to upgrade your footwear game. Act now and experience the difference with MegaShoe 1s!\n\nSeize the Day! Snag 20% off your first MegaShoe 1s purchase and step into a world of unparalleled comfort and style. Limited time offer - Act Now and Transform Your Stride! Kind Regards, Your Comrades at Max\'s Store.', '"None, Your Special Gift from Max\'s Store is Waiting!"\n\nHello there, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re offering you an exclusive deal that\'s too good to resist. Stay tuned for a surprise gift!\n\nAre your current shoes not keeping up with your active lifestyle? We understand the struggle, and that\'s why we\'re excited to introduce our new MegaShoe 1s. These shoes are not just another pair to add to your collection, but a game-changer in comfort and durability. They\'re designed with soft, breathable materials for all-day comfort, and feature superior arch support for those high-impact activities. But that\'s not all - they also boast a sleek, versatile design that looks great whether you\'re at the gym or out on the town. And here\'s the best part: for a limited time, we\'re offering a 50% discount on the MegaShoe 1s. This is a deal you don\'t want to miss, so act fast! We\'re confident that once you try the MegaShoe 1s, you\'ll wonder how you ever got by without them.\n\nAct Now! Snag 50% off your first MegaShoe 1s purchase and step into a world of unparalleled comfort and style. This offer won\'t last forever - Shop Now and Kickstart Your Journey! Yours Truly, Your Friends at Max\'s Store.', '"Ivor, Your Exclusive Max\'s Store Discount Awaits!"\n\nHello Ivor, We\'re thrilled to announce the launch of our latest innovation, the MegaShoe 1s. As one of our esteemed customers, we\'re offering you an exclusive, time-sensitive deal you won\'t want to miss!\n\nAre your current shoes just not cutting it anymore? We understand the struggle! That\'s why we\'re excited to introduce our latest innovation, the MegaShoe 1s. These shoes are designed to keep you comfortable, supported, and stylish, no matter what your day brings. They feature soft, breathable materials for ultimate comfort, arch support for those high-impact activities, and a sleek design that transitions seamlessly from the gym to the streets. But that\'s not all! For a limited time, we\'re offering a special 20% off on the MegaShoe 1s. This is a deal you don\'t want to miss, so act fast and upgrade your shoe game today!\n\nStep Up Your Style! Enjoy a 20% discount on your first MegaShoe 1s purchase. Experience the perfect blend of comfort and sophistication. Act Fast - This Offer Won\'t Last! Yours Truly, Your Friends at Max\'s Store.', '"Hey Gary, Your Exclusive Max\'s Store Discount Awaits!"\n\nHi Gary, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re offering you an exclusive first dibs and an unbeatable discount that\'s too good to miss.\n\nAre your current kicks not keeping up with your active lifestyle? We understand the struggle and that\'s why we\'ve introduced the MegaShoe 1s. These shoes are not just another pair, they\'re a game changer. They\'re designed with top-notch comfort technology, providing your feet with the cushioning and breathability they need to stay happy all day. Plus, they offer superior support for high-impact activities, thanks to their stability features and arch support. But it\'s not all about function, the MegaShoe 1s also bring fresh style to the table with their sleek design that\'s perfect for both workouts and everyday wear. And here\'s the kicker, for a limited time, we\'re offering a special deal on these bad boys. But hurry, this offer won\'t last forever! So why wait? Step up your shoe game and grab a pair of MegaShoe 1s today.\n\nAct Now! Snag 20% off your first MegaShoe 1s purchase and feel the difference in every step. Limited time offer - Shop Now and Step into Greatness! Yours Truly, Your Friends at Max\'s Store.', '"Oleg, Your Exclusive Discount at Max\'s Store is Waiting!"\n\nSubject: Exclusive Offer Just For You, Oleg!\n\nHi Oleg, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re offering you a limited-time, unbeatable deal you won\'t want to miss.\n\nAre your current shoes not keeping up with your active lifestyle? We\'ve got just the solution for you! Introducing the MegaShoe 1s, our latest innovation in footwear. These shoes are not just comfortable, they\'re also designed to provide the support you need for your high-energy activities. The MegaShoe 1s are crafted with soft, breathable materials for all-day comfort, and feature arch support for those high-impact workouts. Plus, their sleek design ensures you\'ll look great whether you\'re at the gym or out on the town. But that\'s not all! For a limited time, we\'re offering a special 50% off deal on the MegaShoe 1s. This is an opportunity you won\'t want to miss, so act fast! With the MegaShoe 1s, you\'ll get the comfort, support, and style you need at a price that won\'t break the bank. So why wait? Upgrade your footwear game with the MegaShoe 1s today!\n\nSeize the Day! Snag a whopping 50% off your first purchase and feel the difference in quality. This offer won\'t last forever - Shop Now and Step Up Your Game! Yours Truly, Your Comrades at Max\'s Store.', '"John, Your Exclusive Max\'s Store Discount is Waiting!"\n\nSubject: Exclusive Offer Just for You, John! \n\nHi John, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re offering you an unbeatable deal - a whopping 30% off for a limited time only. Don\'t miss out!\n\nEver feel like your shoes just can\'t keep up with your active lifestyle? We\'ve got the perfect solution for you! Introducing our brand-new MegaShoe 1s, designed to provide the ultimate comfort, support, and durability. These shoes are packed with features that make them a game-changer for any fitness enthusiast. They offer superior comfort with their breathable materials and cushioning, ensuring your feet stay happy all day long. Plus, they come with stability features and arch support for high-impact activities, making them the perfect partner for your workouts. But that\'s not all! Their sleek design makes them versatile enough for both gym and everyday wear. And here\'s the best part: for a limited time, we\'re offering a special deal on the MegaShoe 1s. But hurry, this offer won\'t last long! So why wait? Step up your shoe game and grab a pair of MegaShoe 1s today!\n\nStep Up Your Style! Score 20% off your first MegaShoe 1s purchase and feel the difference of premium comfort. Act Now and Kickstart Your Journey to Better Footwear! Yours Truly, Your Friends at Max\'s Store.', "Asher, Your Exclusive Max's Store Coupon is Waiting!\n\nSubject: Exclusive Offer Just for You, Asher! \n\nHi Asher, Step up your game with our latest release, the MegaShoe 1s! As one of our top customers, we're giving you first dibs and an unbeatable deal you won't want to miss. Stay tuned for a surprise inside!\n\nEver feel like your shoes just can't keep up with your active lifestyle? We hear you! That's why we're excited to introduce our brand-new MegaShoe 1s. These aren't just any shoes - they're your new go-to for comfort, support, and style. With their innovative design, they're perfect for everything from hitting the gym to running errands. Here's what makes them stand out: Unbeatable comfort: Soft materials and arch support to keep your feet happy. Style for days: A sleek design that looks great no matter what you're up to. Built to last: Durable construction that can handle your busiest days. And here's the best part: for a limited time, we're offering a special deal on the MegaShoe 1s. But hurry - this offer won't last forever! So why wait? Step into comfort and style today with the MegaShoe 1s.\n\nScore Big Today! Snag 20% off your first MegaShoe 1s purchase and step into a world of unmatched comfort and style. Hurry, this offer won't last - Shop Now and Kickstart Your Journey to Excellence! Cheers, Your Pals at Max's Store.", '"Xanthus, Your Special Gift Awaits at Max\'s Store!"\n\nHello Xanthus, Step into the future with our brand new MegaShoe 1s! As a highly valued customer, we\'re offering you an exclusive deal you won\'t want to miss. Plus, there\'s a surprise gift waiting for you.\n\nAre you on the hunt for a shoe that can keep up with your active lifestyle? Look no further! Our newly launched MegaShoe 1s are the perfect blend of comfort, durability, and style. These shoes are designed with soft, breathable materials that provide all-day comfort and arch support, making them ideal for both high-impact activities and casual wear. Plus, their sleek design ensures you\'ll look great no matter where you\'re headed. But that\'s not all - for a limited time, we\'re offering a special deal on the MegaShoe 1s. Don\'t miss out on this opportunity to upgrade your shoe game. Act now and experience the difference a quality shoe can make!\n\nAct Now! Snag your exclusive gift with your first MegaShoe 1s purchase. Experience the perfect balance of comfort and style that\'s just right for you. Limited time offer - Shop Now and Step Up Your Game! Cheers, Your Pals at Max\'s Store.', '"Raja, Your Special Gift Awaits at Max\'s Store!"\n\nHi Raja, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re giving you first dibs on this exclusive release, along with a special offer you won\'t want to miss.\n\nAre your current shoes just not cutting it anymore? We\'ve got the perfect solution for you! Introducing our brand-new MegaShoe 1s, a shoe that\'s not just a shoe, but a game changer. This isn\'t your average footwear - it\'s a blend of comfort, style, and durability that\'s perfect for your active lifestyle. The MegaShoe 1s are crafted with soft, breathable materials for all-day comfort, and feature superior arch support for those high-impact activities. Plus, their sleek design is versatile enough to take you from the gym to the streets in style. But here\'s the kicker - for a limited time, we\'re offering an exclusive 20% off on your first pair. That\'s right, a top-notch shoe at a fraction of the cost! But hurry, this offer won\'t last forever. So why wait? Step up your shoe game and grab your pair of MegaShoe 1s today!\n\nAct Now! Snag a whopping 20% off your first purchase and experience the pinnacle of high-quality products. This is your golden ticket to an exclusive gift, but hurry - this offer won\'t last forever! Shop Now and Reap the Rewards! Yours Truly, Your Friends at the Store.', '"Tyler, Your Special Gift from Max\'s Store is Waiting!"\n\nHey Tyler, Get ready to step up your game with our latest release, the MegaShoe 1s! As one of our top customers, we\'re offering you an unbeatable deal you won\'t want to miss.\n\nAre your current kicks just not cutting it anymore? If you\'re in need of a shoe upgrade that can keep pace with your active lifestyle, we\'ve got just the thing for you. Introducing the MegaShoe 1s - the ultimate blend of comfort, durability, and style. These shoes are packed with features designed to keep your feet happy, no matter what the day throws at you. The MegaShoe 1s offer superior cushioning for all-day comfort, enhanced support for high-impact activities, and a sleek design that looks great whether you\'re hitting the gym or hanging out with friends. But that\'s not all - for a limited time, we\'re offering a special deal on the MegaShoe 1s. Don\'t miss out on this opportunity to step up your shoe game. Act now and experience the difference the MegaShoe 1s can make.\n\nAct Now! Score an unbeatable 20% off your first MegaShoe 1s purchase and feel the difference in every step. Limited stock - Shop Now and Step Up Your Game! Yours Truly, Your Pals at Max\'s Store.', '"Hey Ira, Your Exclusive Max\'s Store Coupon Awaits!"\n\nHi Ira, Time is running out to snag our latest sensation - the MegaShoe 1s! As one of our top customers, we\'re offering you an unbeatable deal that you won\'t want to miss. Stay tuned for a special coupon coming your way!\n\nAre your current kicks not keeping up with your active lifestyle? We\'ve got just the solution for you! Introducing our brand-new MegaShoe 1s, designed to keep you comfortable, supported, and stylish, no matter what your day throws at you. These shoes are packed with features that make them a game-changer: they\'re crafted with soft, breathable materials for all-day comfort, have built-in arch support for those high-impact activities, and boast a sleek design that\'s versatile enough for both the gym and your daily errands. But that\'s not all - for a limited time, we\'re offering a special deal on these must-have shoes. Don\'t miss out on this opportunity to step up your shoe game! We encourage you to act fast and secure your pair of MegaShoe 1s today.\n\nAct Now! Snag your 20% off coupon and experience the unmatched comfort of our MegaShoe 1s. This offer won\'t last forever - Shop Now and Step Up Your Game! Yours Truly, Your Friends at Max\'s Store.', '"John, Your Exclusive Max\'s Store Discount is Waiting!"\n\nHi John, Step into the future with our brand new MegaShoe 1s! As one of our top customers, we\'re offering you an unbeatable deal - a whopping 30% off for a limited time only. Don\'t miss out!\n\nAre your current shoes not keeping up with your active lifestyle? We understand the struggle and that\'s why we\'ve introduced the MegaShoe 1s, a game-changer in footwear. These shoes are not just about style, but also about comfort and durability. They feature soft, breathable materials for all-day comfort, and robust construction to withstand your daily grind. Plus, their sleek design makes them versatile for any occasion. But that\'s not all! We\'re offering a special deal for a limited time only - 20% off your purchase of MegaShoe 1s. This is an opportunity you don\'t want to miss. So why wait? Step into comfort and style with the MegaShoe 1s today!\n\nStep Up Your Style! Snag 20% off your first purchase and experience the perfect blend of comfort and fashion. Don\'t wait - Shop Now and Elevate Your Look! Yours Truly, Your Friends at Max\'s Store.']</code></pre>
</div>
</div>
<div id="a4bdc28c-87b7-4903-99da-fe98a0f6cd17" class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">'emails.csv'</span>, <span class="st">'w'</span>, newline<span class="op">=</span><span class="st">''</span>) <span class="im">as</span> csvfile:</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    writer <span class="op">=</span> csv.writer(csvfile)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    writer.writerow([<span class="st">"Emails"</span>])  <span class="co"># header row</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> email <span class="kw">in</span> emails:</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>        writer.writerow([email])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The details of the results and possible implications will be explored deeper in the next post</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yummyhopper\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>