<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Max Orenstein">
<meta name="dcterms.date" content="2024-05-23">
<meta name="description" content="This paradigm shift signals a major change for those in the business of providing answers, particularly SEO marketers. So, what does this mean for the evolving landscape of SEO, will you lose valuable clicks, and what can you do about it?">

<title>Max’s Blog - Search Is Changing And It Will Effect What People Click On</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Max’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://yummyhopper.github.io/comm4190_S24_Using_LLMs_Blog/"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/max-orenstein-159b8a237/"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Search Is Changing And It Will Effect What People Click On</h1>
                  <div>
        <div class="description">
          This paradigm shift signals a major change for those in the business of providing answers, particularly SEO marketers. So, what does this mean for the evolving landscape of SEO, will you lose valuable clicks, and what can you do about it?
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Search</div>
                <div class="quarto-category">AI</div>
                <div class="quarto-category">Google</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Max Orenstein </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 23, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="search-is-changing-and-it-will-effect-what-people-click-on" class="level3">
<h3 class="anchored" data-anchor-id="search-is-changing-and-it-will-effect-what-people-click-on">Search Is Changing And It Will Effect What People Click On</h3>
<p>AI and Search are both question-answering machines. Until recently Google had the best question-answering machine, gathering a dominant 90% market share amongst search engines. However AI has challenged this stranglehold by answering questions in new ways. AI can generate more personalized results, reason in multiple steps, and learn through many different modalities. Plain old Google is no longer the best question-answering machine and the company has just made a major move to address it’s shiny new competition. This paradigm shift signals a major change for those in the business of providing answers, particularly SEO marketers. So, what does this mean for the evolving landscape of SEO, will you lose valuable clicks,and what can you do about it?</p>
<blockquote class="blockquote">
<p>“When search grows up, it will look like Star Trek: you talk into the air (“Computer! What’s the situation down on the planet?”) and the computer processes your question, figures out its context, figures out what response you’re looking for, searches a giant database in who-knows-how-many languages, translates/analyses/summarises all the results, and presents them back to you in a pleasant voice. I think this technology is about, oh, 300 years off.” - <em>Craig Silverstein, Google CTO (2003)</em></p>
</blockquote>
</section>
<section id="the-startrek-computer" class="level3">
<h3 class="anchored" data-anchor-id="the-startrek-computer">The StarTrek Computer</h3>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Theultimatecomputerhd0191.webp" class="img-fluid figure-img"></p>
<figcaption>The Ultimate Computer (StarTrek)</figcaption>
</figure>
</div>
<p>During last weeks annual developer conference Google made several bombshell AI announcements including major changes to its flagship product Google Search. Google is expanding search capabilities using it’s own generative AI model Google Gemini. The new model, which integrates real-time data and advanced ranking systems, is designed to make search more accurate and efficient. Here are the new features:</p>
<ul>
<li><strong>AI overviews</strong>: Google will now include AI overviews of search results with the links to the websites the AI has summarized below.</li>
<li><strong>Multi-step Reasoning</strong>: Google introduces multi-step reasoning to break down complex queries into sub-questions, providing detailed and organized overviews.</li>
<li><strong>Advanced Planning Capabilities</strong>: Google’s AI can assist with planning tasks like meal plans and trips, providing detailed and customizable plans.</li>
<li><strong>AI Organized Pages</strong>: For brainstorming and inspiration, Google provides AI-organized search result pages with various clusters of information.</li>
<li><strong>Video-based Search Queries</strong>: Google introduces the ability to ask search questions using videos, leveraging advanced speech and visual recognition technologies.</li>
</ul>
<p>Adding these sort of features improves the depth and breadth of questions search results are able to answer. Since AI was introduced to Microsoft Edge in the form of BingChat I’ve actually switched from Google to Edge as my main browser. I find the AI search results and websites complementary, since sometimes it will just tell you the answer to your question instead of having to click on a link. I also like having the option to chat with an LLM because they tend to be better for certain types of questions, often when I have a lot of follow up questions connected to the first one. Based on my own search habits I tend to think how companies choose to integrate AI into search will be one of the most important factors for consumers in the long term.</p>
</section>
<section id="perplexing-a-monopoly" class="level3">
<h3 class="anchored" data-anchor-id="perplexing-a-monopoly">Perplexing a Monopoly</h3>
<p><img src="perplexity.PNG" class="img-fluid"></p>
<p>This development from Google is a direct response to the new kids on the block: AI search engines. The leader of the pack right now is Perplexity, the AI powered “Swiss Army Knife” for information discovery and curiosity. Perplexity is an AI startup that began in 2022 and today has raised $165 million in funding and is valued at over $1 billion. Behind a modern suave looking UI, Perplexity interprets the context of the user queries and provide a personalised search result complete with inline citations and website URLs. It provides the unbique ability to “chat with the web” almost as you would a person. With over 2 million downloads and responding to 1 million queries per day, the company is experiencing the sort of rapid adoption that could start to chip away at Google’s massive search engine market share. While Perplexity has plans to display ads in the “related questions” section of its search results this form of brand-sponsored queries has not been rolled out yet and introduces a whole nother can of worms. Browsers like Brave and Bing have also release AI search tools which are integrated into their existing search products and OpenAI is rumored to be releasing their own search tool soon. This wave of industry innovation highlights the economic realities of Google’s decision in this competitive market. We can’t ignore the bottom line market dynamics that are the true catalyst for this move. Not that there’s anything inherently wrong with trying to maintain market shar on the competition, Google absolutely should be doing such things. More to say we should take Google’s rosy utopian optimism about certain aspects of this technology with a grain of salt, holding them to a high standard of corporate responsibility and recognizing their dominant role as the world’s favorite serarch engine.</p>
</section>
<section id="this-wont-increase-clicks.-stop-gaslighting-us." class="level3">
<h3 class="anchored" data-anchor-id="this-wont-increase-clicks.-stop-gaslighting-us.">This won’t increase clicks. Stop gaslighting us.</h3>
<p><img src="498.png" class="img-fluid"></p>
<p>What I’m getting at is statements like these:</p>
<blockquote class="blockquote">
<p>“With AI Overviews, people are visiting a greater diversity of websites for help with more complex questions. And we see that the links included in AI Overviews get more clicks than if the page had appeared as a traditional web listing for that query. As we expand this experience, we’ll continue to focus on sending valuable traffic to publishers and creators. As always, ads will continue to appear in dedicated slots throughout the page, with clear labeling to distinguish between organic and sponsored results.” - <em>Liz Reid, VP, Head of Google Search (2024)</em></p>
</blockquote>
<p>Where do they see that? What’s the evidence? Where are the research papers? When asked such question Google has remained evasive. While it may be a while until proper research comes out it seems clear that at least some types of websites will lose traffic. Furthermore there are ethical dilemmas surrounding how these models are trained that make this situation seems that much worse. These AI overviews are trained on data from the very websites that are getting screwed over. Moreover, there’s no way for smaller sights to combat this. While companies like OpenAI have lists that can allow companies to not consent to using their information as training data, it’s different for Google. This is because Google’s web crawler both scrapes the web for data to train on and participates in ranking search results at the same time. Large media companies have had some success getting paid for allowing AI companies to use their content for training, but the little fish haven’t.</p>
<p>My best defense of Google is that they are fundamentally an advertising company. No one is hurt more if AI overviews compromise ad revenue than Google themselves. So then why are they doing this? This cuts to the core of Google’s biggest internal conflict as a company: their dual commitment to appeasing users and advertisers. If Google is to maintain market share they must make a better search product, and if they want to make money they must make figure out how to get advertisers more clicks. Notice the subtleties to the way Google rides this line: undercover search ads, product suggestions, and soon AI suggestions. It’s a bit frustrating Google can’t have an honest nuanced discussion about these fundamental realities of their decision and instead rely on umbrella claims backed by nonexistant evidence.</p>
</section>
<section id="how-will-this-impact-seo" class="level3">
<h3 class="anchored" data-anchor-id="how-will-this-impact-seo">How will this impact SEO?</h3>
<p><img src="73729803007-ai-overview-sofa-still.webp" class="img-fluid"></p>
<p>There are plenty of search queries that an AI generated response at the top of the page will answer far better than an actual website landing page. It will probably be a little bit until conclusive research has come out on this topic, but that doesn’t have to stop us from speculating. Based on my experience using Bing, there are some types of questions that AI is better at answering and some that traditional search is better at, and I think saying “quality content” will get the edge is a little reductive. To illustrate this here are a couple areas where AI-generated responses are likely to excel:</p>
<ol type="1">
<li><strong>Simple Fact-Based Questions:</strong>
<ul>
<li><strong>Example:</strong> “What is the capital of France?”
<ul>
<li><strong>AI Response:</strong> “The capital of France is Paris.”</li>
<li><strong>Traditional Search:</strong> Multiple links to articles and websites with the same information, often requiring more clicks to find the answer.</li>
</ul></li>
</ul></li>
<li><strong>Summarized Information:</strong>
<ul>
<li><strong>Example:</strong> “Summarize the plot of ‘Pride and Prejudice.’”
<ul>
<li><strong>AI Response:</strong> A concise summary of the book’s plot.</li>
<li><strong>Traditional Search:</strong> Links to various summaries, requiring users to read through and piece together the information.</li>
</ul></li>
</ul></li>
<li><strong>Calculations and Conversions:</strong>
<ul>
<li><strong>Example:</strong> “Convert 100 USD to EUR.”
<ul>
<li><strong>AI Response:</strong> The conversion result based on current exchange rates.</li>
<li><strong>Traditional Search:</strong> Links to currency conversion tools and websites.</li>
</ul></li>
</ul></li>
<li><strong>Definitions and Explanations:</strong>
<ul>
<li><strong>Example:</strong> “What is photosynthesis?”
<ul>
<li><strong>AI Response:</strong> A brief explanation of photosynthesis.</li>
<li><strong>Traditional Search:</strong> Links to educational websites and articles.</li>
</ul></li>
</ul></li>
</ol>
<p>Meanwhile, here are some areas where traditional search will likely maintain the edge:</p>
<ol type="1">
<li><strong>In-Depth Research:</strong>
<ul>
<li><strong>Example:</strong> “What are the latest advancements in cancer research?”
<ul>
<li><strong>AI Response:</strong> An over-generalized and simplistic interview overview with outdated information.</li>
<li><strong>Traditional Search:</strong> Access to recent research papers, articles, and news reports from credible sources.</li>
</ul></li>
</ul></li>
<li><strong>Product Reviews and Comparisons:</strong>
<ul>
<li><strong>Example:</strong> “Best laptops under $1000.”
<ul>
<li><strong>AI Response:</strong> A general recommendation, possibly augmented by advertising in some way in the near future.</li>
<li><strong>Traditional Search:</strong> Detailed reviews, comparison articles, and user feedback from multiple websites.</li>
</ul></li>
</ul></li>
<li><strong>Local Services and Businesses:</strong>
<ul>
<li><strong>Example:</strong> “Best Italian restaurants in New York City.”
<ul>
<li><strong>AI Response:</strong> A short list based on popular choices.</li>
<li><strong>Traditional Search:</strong> Links to review sites, maps, and detailed information about each restaurant.</li>
</ul></li>
</ul></li>
<li><strong>Detailed How-To Guides:</strong>
<ul>
<li><strong>Example:</strong> “How to install a new hard drive in a laptop.”
<ul>
<li><strong>AI Response:</strong> A brief set of steps.</li>
<li><strong>Traditional Search:</strong> Comprehensive guides, video tutorials, and forums with troubleshooting tips.</li>
</ul></li>
</ul></li>
</ol>
<p>Chances are you can probably tell if AI overviews are going to be a problem for your website, but if you’re unsure you can evaluating the <strong>three S’s: Simplicity, Specificity, Speed.</strong></p>
<ol type="1">
<li><strong>Simplicity</strong>: If the query can be answered with a straightforward fact or a brief summary, AI-generated responses are likely to satisfy the user’s needs. Examples include factual questions, basic definitions, or simple instructions. In such cases, AI might reduce traffic to your site. If the answer requires nuanced, highly specialized information, detailed explanations, or in-depth analysis, traditional search results will be more valuable. Users looking for comprehensive guides, detailed reviews, or complex research findings will benefit more from visiting multiple sources.</li>
<li><strong>Specificity</strong>: Queries seeking broad or introductory information can often be adequately addressed by AI-generated summaries. This includes overviews, brief descriptions, or basic knowledge that doesn’t require deep verification or sources. Specialized Information: If the user needs detailed, specific, and highly accurate information, they are more likely to rely on traditional search results. This includes queries that demand expert opinions, technical details, or verified data from reputable sources.</li>
<li><strong>Speed</strong>: For queries where users expect rapid, concise answers, AI-generated responses will often be sufficient. These users are typically looking for immediate results without needing to dive into detailed content. If your users are typically willing to spend time reading through detailed articles, watching comprehensive tutorials, or exploring in-depth content, traditional search results will better meet their needs. These users value thoroughness and are prepared to invest time in understanding complex information.</li>
</ol>
<p>The three S’s can also be useful guidlines to adjusting your SEO strategy to fit this evolving environment. If you’ve seen a tick down in your website traffic since Google’s AI overviews it’s likely because of one of these three factors. Search has seen many advancements in its features throughout its 20ish year lifespan. Change is, fortunately or unfortunately, a constant the SEO digital marketing landscape. There will be ways to game AI overviews, similar to traditional search and those who figure out the best strategies will get still ahead in the race to the top of the page. Especially as advertising becomes integrated on a more normalized basis this will be an interesting area to keep an eye on. Those who stick to their old methods will be mercilessly ruled out and there’s likely to be a thinning of the pack in a lot of digitally focused industries. However this is not the end of search or SEO, rather it’s the beggining of a new paradigm. The sites that survive this shift will be the one most adapted to the new search environment. Keep evolving and stay groovy.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/yummyhopper\.github\.io\/comm4190_S24_Using_LLMs_Blog\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>